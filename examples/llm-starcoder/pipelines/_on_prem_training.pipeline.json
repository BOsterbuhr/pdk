{
  "pipeline": {
    "name": "training",
    "project": {
      "name": "starcoder"
    }
  },
  "description": "Detects changed files into a repository and triggers a retraining on that dataset",
  "input": {
    "cross": [
      {
        "pfs": {
          "name": "data",
          "repo": "hf-python-data",
          "branch": "master",
          "project": "starcoder",
          "glob": "/",
          "emptyFiles": true
        }
      },
      {
        "pfs": {
          "name": "model",
          "repo": "hf-download-starcoder-model",
          "branch": "master",
          "project": "starcoder",
          "glob": "/",
          "emptyFiles": true
        }
      }
    ]
  },
  "transform": {
    "cmd": [
      "/bin/sh"
    ],
    "stdin": [
      "python train.py --git-url https://git@github.com:/determined-ai/pdk.git --git-ref starcoder --sub-dir examples/llm-starcoder/experiment --config distrib.yaml --repo hf-download-starcoder-model,hf-python-data --model starcoder-python --project starcoder"
    ],
    "image": "pachyderm/pdk:train-v0.0.4",
    "secrets": [
      {
        "name": "pipeline-secret",
        "key": "det_master",
        "envVar": "DET_MASTER"
      },
      {
        "name": "pipeline-secret",
        "key": "det_user",
        "envVar": "DET_USER"
      },
      {
        "name": "pipeline-secret",
        "key": "det_password",
        "envVar": "DET_PASSWORD"
      },
      {
        "name": "pipeline-secret",
        "key": "pac_token",
        "envVar": "PAC_TOKEN"
      }
    ]
  },
  "autoscaling": true,
  "podPatch": "[{\"op\": \"add\",\"path\": \"/volumes/-\",\"value\": {\"name\": \"det-checkpoints\",\"hostpath\": {\"path\": \"/lus/aiholus1/disk/determined/checkpoints\",\"type\": \"Directory\"}}}, {\"op\": \"add\",\"path\": \"/containers/0/volumeMounts/-\",\"value\": {\"mountPath\": \"/determined_shared_fs\",\"name\": \"det-checkpoints\"}}]"
}
